<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    
</body>
<script>
//Cosa sono: indica lo STATO di una richiesta

//ESEMPIO di richiesta dati asincrona con Promises
// scegliCondimenti()
//     .then(function (condimenti){
//         return piazzaOrdine(condimenti)
//     })
//     .then(function (ordine){
//         return collezionaOrdini(ordine)
//     })
//     .then(function (pizza){
//         mangiaPizza(pizza)
//     })
//     .catch(failureCB);

//Esempio di chiamata asincrona con fetch e Promise
// fetch('coffe.jpg')//Restituisce una Promise
//     .then(res => {
//         if(!res.ok){//Se la risposta non è ok
//             throw new Error (`HTTP error! status: ${res.status}`)// L’operatore throw serve a generare un errore
//         }else {
//             return res.blob();
//         }
//     })
//     .then(myBlob => {
//         let objURL = URL.createObjectURL(myBlob)//Creiamo sempre l'url
//         let img = document.createElement('img');//Creiamo il tag <img>
//         img.src = objURL//immettiamo l'url nell'attr src
//         document.body.appendChild(img)//"Appendiamo" al body
//     })
//     .catch(e => {
//         console.log('There is a problem with fetch operation', e.message);
//     })

// Come creare una Promise

// let timeoutPromise = new Promise((res, rej) => {//La Promise si aspetta due parametri: o viene ritornato il risultato (res) o viene respinta (rej)
//     setTimeout(() => {
//         res('Success!')
//     }, 2000);
// })

//Esempio pratico

function timeoutPromise (mes, interval) {
    return new Promise((res, rej) => {
        if(mes === '' || typeof message !== 'string') {//Controllo mes
            rej('Il messaggio è vuoto o non è una stringa')
        }else if(interval < 0 || typeof interval !== 'number'){//Controllo timer
            rej("L'intevallo è negativo o non è un numero")
        }else{
            setTimeout(() => {
                res(mes)
            }, interval);
        }
})
}

timeoutPromise('Ciao', 1000)
    .then(mes => {
        alert(mes);
    })
    .catch(e => {
        console.log('Error ' + e);
    })

</script>
</html>